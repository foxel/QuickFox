<?php

// ----------------------------------------------------------- \\
//            QuickFox setup script           (c) LION 2006    \\
// ----------------------------------------------------------- \\


// this is TAR unpacker in gz compressed format (setup.php is 5 kB now instead of 14)
$TAR_GZ_Class =
'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
G7SJjtLaL3f9+A8cyVw3';

foreach ($_REQUEST as $rvar=>$rval) {
    unset ($$rvar);
}

define ('QF_STARTED',True);
define ('QF_SETUP_STARTED',True);

//$debug=1;
if (!defined('E_STRICT'))
    define('E_STRICT', 2048);
if (!defined('E_RECOVERABLE_ERROR'))
    define('E_RECOVERABLE_ERROR', 4096);
if (!defined('E_DEPRECATED'))
    define('E_DEPRECATED', 8192);
if (!defined('E_USER_DEPRECATED'))
    define('E_USER_DEPRECATED', 16384);
Error_Reporting(E_ALL & ~(E_NOTICE | E_USER_NOTICE | E_STRICT | E_DEPRECATED) );

set_magic_quotes_runtime(0);
if (ini_get('safe_mode') == 0)
    set_time_limit(0);

function init_err_parse($errno, $errstr, $errfile, $errline)
{
global $debug;
If ($debug) {
   if ($errno!=8&&$errno!=1024)
   print 'Error '.$errno.'. '.$errstr.'<hr>File: '.$errfile.'. Line: '.$errline.'<br />';
}
}

//Lets Set init_err_handler
set_error_handler('init_err_parse');

$SET_step=strval($_POST['step']);
$SET_act=strval($_POST['action']);
$error='';

if (!empty($SET_step) && file_exists('install/install.php'))
    include ('install/install.php');

else {

print '
<html>

<head>
  <title>Installing QuickFox</title>
</head>

<body>
<div align="center">
<form action="setup.php" method="post" name="mainform">
';

if ($SET_act == 'GO')
{
    $file = 'pack.tgz';
	if (!file_exists($file))
	    $file = 'upd_pack.tgz';

    eval(gzuncompress(base64_decode($TAR_GZ_Class)));

	$arch = new TGZRead($file);
	if (!$arch->stream)
	    $error='Error loading archive';
	else {
	    $arch->ExtractArchive('',True);

        if (!file_exists('index.php') || !file_exists('install/install.php'))
            $error='Error extracting pack';
    }

    if (!$error) {
	    chmod($file,octdec('600'));
	    print '
        <h3>All the data is extracted!</h3>
        <input type="hidden" name="step" value="data_acc" />
        Now We must set up some settings. <br />
        <input type="submit" name="OK" value="GO!" />
	    ';
    }
    else
        print $error;

}
else {
    print '
    <h3>Now We are ready to install QuickFox on this server!</h3>
    <input type="hidden" name="action" value="GO" />
    First We must Extract data. <br />
    <input type="submit" name="OK" value="GO!" />
    ';
}

print '</form></div>
</body>

</html>';

}
?>
